# 练习1
1. 设计实现过程。  
default_init_memmap  
首先对所有的页进行初始化，包括清空PG_reserved，设置PG_property，将property和ref清零，再加到空闲页链表中。最后将总的nr_free和第一个可用页的property设为n。  
default_alloc_pages  
对将要分配的n页进行处理，包括清空PG_property，设置PG_reserved，然后从空闲页链表中删除。将紧接分配的页之后的那一页也就是新的链表头的property和nr_free设置为原来链表头的property-n。这里要注意一种情况就是如果这两页之间有空洞，那么说明前面的页面恰好能满足分配的要求，这一页的property就不用修改了。  
default_free_pages   
首先根据地址大小顺序找到释放的页在链表中的位置，然后将这些页的PG_reserved清空，设置PG_property，将ref清空，依次加入刚才找到的位置处。 然后将第一个页的property设置为n。接下来如果新释放的空间和之前的空间连续的话，则需要进行合并操作。分别向前向后寻找，如果base+base->property==p或者p+p->property==base，则可以进行合并，需要修改相应页面的property值。最后更新nr_free的值。  

1. 你的first fit算法是否有进一步的改进空间？  
有。可以像参考答案一样不将所有的空闲页都加入到链表中，而是只将第一个页面加入，提高算法的效率。

# 练习2
1. 设计实现过程。  
get_pte
按照注释的步骤，首先得到pde的指针，然后判断页目录项是否存在，如果不在的话要分配一个新的页，将引用计数设为1。然后得到页面的物理地址，将页面内容清零，设置pde页面的一些访问权限。最后通过地址la得到所在页面的页表项。

1. 请描述页目录项（Pag Director Entry）和页表（Page Table Entry）中每个组成部分的含义和以及对ucore而言的潜在用处。
PDE前20位是页表物理地址的前20位，后12位是一些标志位；PTE前20位是页面物理地址的前20位，后12位也是一些标志位。ucore通过二级页表的前20位完成虚拟地址到物理地址的转换，后12位是完成访问控制等功能，表示页面的读写权限等。  

1. 如果ucore执行过程中访问内存，出现了页访问异常，请问硬件要做哪些事情？
产生中断，刷新TLB的缓存,从硬盘载入需要访问的页面

# 练习3
1. 设计实现过程
按照注释的步骤，首先检查页表项是否存在，得到对应的页面，将引用计数减一，如果引用计数变为0就把这一页释放掉。清空页表项，然后刷新tlb。

1. 数据结构Page的全局变量（其实是一个数组）的每一项与页表中的页目录项和页表项有无对应关系？如果有，其对应关
系是啥？
页目录项和页表项都对应着Page中的一项，但是Page中未分配的页面则无这种对应关系。

1. 如果希望虚拟地址与物理地址相等，则需要如何修改lab2，完成此事？ 鼓励通过编程来具体完成这个问题
将`#define KERNBASE            0xC0000000`改为`#define KERNBASE            0x00000000`
